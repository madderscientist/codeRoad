# srtp制作进程
## md教程
### 三级标题
1. 433
2. rtdg
*斜体*
**加粗**
- hdh
- ng~g~
```cpp
using 
```
换行符<br>换行符

![图片名称](123.png图片地址)
[链接名字](输入链接)

## 1.14
使用cube配置了f103c8t6，成功点亮了oled屏幕，并且使用usb转ttl的串口助手向pc发了东西。<br>
找到了一个使用qt写串口助手的项目，复现了项目，看了代码，想用这个写一个串口接受图片的程序，但是c++有点太难了。
## 1.15
进展缓慢的一天，买的st7789屏幕到了，但是折腾了很久没能点亮。在移植st7735的项目的时候遇到一个问题，我定义了一个约40k的u8数组，但是f103c8的ram只有20k，所以装不下，但是解决这个问题之后还是搞不定st7789。
## 1.16
把st7735拿回来了，尝试移植，但依然失败，原因没有找到。随后更换了f407zg的板子，移植成功，复现了st7735的代码效果。<br>
看了很久ov7670

        存储图像数据
        OV7670 摄像头模块存储图像数据的过程为：等待 OV7670 同步信号→ FIFO 写指针复位→FIFO 写使能→等待第二个 OV7670 同步信号→FIFO 写禁止。通过以上 5 个步骤，我们就完成了1帧图像数据的存储
        读取图像数据
        在存储完一帧图像以后，我们就可以开始读取图像数据了。读取过程为：FIFO 读指针复位→给 FIFO 读时钟（FIFO_RCLK）→读取第一个像素高字节→ 给 FIFO 读时钟→读取第一个像素低字节→给 FIFO 读时钟→读取第二个像素 高字节→循环读取剩余像素→结束。
ov7670太老了，最终决定看这份代码，把它从标准库移植到hal库
[OV7670摄像头模块的介绍以及应用（SCCB的使用）](https://blog.csdn.net/qq_35653974/article/details/126498896)
有一些我觉得值得记下来的东西
1. 摄像头的D[7:0]连到FIFO的DI[7:0]，FIFO的DO[7:0]作为引脚引出。单片机要做的是，通过OV_SCL和OV_SDA设置ov7670，以及通过FIFO的5个脚控制FIFO的读写
2. 在读DO[7:0]的时候，会直接读寄存器，用这样的操作把C0~C7取出来
```C
color=GPIOC->IDR&0XFF;
```
## 1.17
今天接完了摄像头的线，并且写好了程序，初始化用的是硬件i2c，和fifo通信是软件时序。目前显示的内容乱七八糟，今天逻辑分析仪到了，抓取i2c的sda和scl，发现全是乱的，推测是硬件i2c有问题，很奇怪，计划明天接oled屏看看时序，不行就改软件SCCB
## 1.18
**唐** 昨天有三个问题
1. 逻辑分析仪采样率太小，导致i2c抓的不对，我把那个sample当成了采样率，其实是采样数，另一个才是采样率。
2. 地址不对，i2c地址是7位，再加上最低一位的读写位，移植的arduno那份代码里的0x21我不知道是哪来的，换成0x42就对了
3. 初始化函数没调。。。这种傻逼错误什么时候才能不犯

把项目上传到了GitHub，再次上传的操作如下:
```bash
git add .
git commit -m "标题"
git push
```
### ov7670使用方法记录（记完就可以把草稿纸扔了）
ov7670_fifo的端口如下<br>

GND     SIOD    ~~W(H)REF~~     D6 D4 D2 D0     ~~PWDN~~        RCK(FIFO)       ~~OE(FIFO)~~    RRST(FIFO)<br>
VCC     SIOC    VSYNC           D7 D5 D3 D1     RST             ~~STROBE~~      WR(FIFO)        WRST(FIFO)<br>   

其中划线的部分是我没有用到的引脚。<br>
其中SIOD和SIOC可以用i2c，对ov7670的寄存器进行初始化。VSYNC是帧同步，cam在开始新的一帧的时候，会拉低VSYNC，这时候可以告诉FIFO开始记录了。<br>
然后是对FIFO进行操作，流程如下
#### 写操作
1. 在第一个帧同步复位写指针（WRST=0->1）
2. 写使能（WEN=1）
3. 在第二个帧同步写禁止（WEN=0）
#### 读操作
1. 读指针复位（RRST=0->1）
2. 输出时钟（RCLK）
3. 读D[7:0]第一个像素的高8位
4. 下一个时钟（具体时钟的变化要看下面）
5. 读D[7:0]第一个像素的低8位
```C
OV7670_RRST = 0; // 开始复位读指针
OV7670_RCK_L;
OV7670_RCK_H;
OV7670_RCK_L;
OV7670_RRST = 1; // 复位读指针结束
OV7670_RCK_H;
//循环
OV7670_RCK_L;
SCREEN[i] = GPIOF->IDR & 0XFF;// 读数据
OV7670_RCK_H;
OV7670_RCK_L;
SCREEN[i+1] = GPIOF->IDR & 0XFF;// 读数据
OV7670_RCK_H;
//循环结束
```
## 1.19
摆烂一整天！
出现了奇怪的事情，屏幕不显示，但是我用手摸任何一个地方就好了，后来把暖脚的毯子关了就好了，但是传来的画面是切割的，明天再试

## 1.20
今天找到了画面抽搐的原因之一，在st7735test函数中，画圆的代码导致数组越界，把这个注释掉就解决了。

## 2.24
把所有寄存器看了一遍，图像颜色还是非常差，遂投向openmv的怀抱.
跑了openmv的找色块例程，没跑出来，但是网上搜了一份可以正常运行。不舒服，不想看了

## 2.25
病了一天
目前openmv可以提取指定区域颜色的lab数值

## 2.26
在研究怎么找色块的rgb值，因为statistics统计的只有灰度和lab

https://docs.singtown.com/micropython/zh/latest/openmvcam/library/omv.image.html#id3